def secrets = [
  [path: 'secrets/creds/jenkins', engineVersion: 2, secretValues: [ 
    [envVar: 'GITHUB_TOKEN', vaultKey: 'username']]],
]

def configuration = [vaultUrl: 'http://192.168.0.49:8200',  vaultCredentialId: 'vault-jenkins-role', engineVersion: 2]

pipeline {
    agent { label "linux" }
    options {
        buildDiscarder(logRotator(numToKeepStr: '20'))
        disableConcurrentBuilds()
    }
    stages{   
      stage('Vault') {
        steps {
          withVault([configuration: configuration, vaultSecrets: secrets]) {
            sh "echo ${env.GITHUB_TOKEN}"
          }
        }  
      }
      stage('Slack'){
        steps {
            slackSend botUser: true, channel: 'pet-projects', color: '#00ff00', 
                 message: 'Testing Jekins with Slack', 
                 tokenCredentialId: 'slack-token'
        }  
      }
    }
}